				<h3 style="margin: 0px;"><i class="icon-bar-chart"></i> SMSC Maintenance Counters</h3>
				<hr style="margin: 10 0px;"/>
				
				<span class="span5 offset7">
					<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="select the refresh rate at which page will be refreshed">
					<span class="add-on">Refresh Rate</span>
					<select id="refresh-rate-select" onchange="refreshRate()">
						<option value="5000">5 Sec</option>
						<option value="10000">10 Sec</option>
						<option value="15000">15 Sec</option>
						<option value="20000">20 Sec</option>
						<option value="30000">30 Sec</option>
						<option selected="selected" value="60000">60 Sec</option>
						<option value="300000">5 Min</option>
						<option value="600000">10 Min</option>
						<option value="900000">15 Min</option>
						<option value="1200000">20 Min</option>
						<option value="1800000">30 Min</option>
						<option value="3600000">60 Min</option>
					</select>
					</span>					
					<button id="refresh" style="float: right; margin-right: 20px; margin-left: 20px; height: 30px;" class="btn btn-medium btn-success" data-toggle="tooltip" data-placement="left" onclick="updateGraphs();" data-original-title="Refresh Graph"><i class="icon-refresh"></i></button>
				</span>
				
				<span id="ras-table-wrapper">
					<table id="no-campaigns-table" class="table" style="display: none;">
						<tr>
							<td>
								<div class="alert alert-info fade in">
									<strong>No Campaigns defined yet!</strong> 
								</div>
							</td>
						</tr>
					</table>	
					
					<table id="no-clusters-table" class="table" style="display: none;">
						<tr>
							<td>
								<div class="alert alert-info fade in">
									<strong>No Cluster Counters defined for chosen campaign!</strong> 
								</div>
							</td>
						</tr>
					</table>
					
					<div id="campaigns-div" class="control-group">
						<span class="input-prepend" data-toggle="tooltip" data-placement="bottom" title="select the campaign to display the metrics graph">
							<div>
								<span class="add-on errors-title">Campaigns</span>
								<select id="campaigns-list-select" onchange="getCountersList()">
									<option value="Select">Select</option>
								</select>
							</div>								
							<div class="next-errors-row">
								<span class="add-on errors-title">Available Clusters</span>
								<select multiple="multiple" id="clusters-list-select" onchange="createGraphs()">
								</select>
							</div>
						</span>
					</div>
					
					<input type="hidden" value="-1" id="timerIdValue"/>
					
					<div id="graphs"/>
					
				</span>
				
				<script type='text/javascript'>
					//@ sourceURL=loadGoogleCharts.js
					
					var charts = {};
					
					var clusterCountersList = [];
					var esmeCountersList = [];

					var selectedClusters = [];
					
					var clustersCountersMap;
					
					function refreshCampaignsList(){
						var counterSetName = "SMSC GW-SMSC-Maintenance";
						jolokia.execute("org.mobicents.ss7:layer=COUNTER,name=CounterHost,type=Management","getCampaignsList", counterSetName,
								{ success: 
									function(response) {
										var noOfCampaigns = 0 ;
										
										jQuery.each(response, function() {
											noOfCampaigns = noOfCampaigns + 1;
											$('#campaigns-list-select').append('<option value='+this+'>'+this+'</option>')										
										});	
										campaignsSelect.reload();
									
										if(noOfCampaigns == 0){
											$('#no-campaigns-table').show();
											$('#campaigns-div').hide();
										}else {
											$('#no-campaigns-table').hide();
											$('#campaigns-div').show();
										}	

									},
									error: function(value) {
										errorUID = ("st" + new Date().getTime()).hashCode();
										createStackTrace(errorUID, value.stacktrace);
										logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
									} 
								}
							);
					}
					
					function getCountersList() {
						getCountersByGroup(clusterCountersList, 'Cluster');
						getCountersByGroup(esmeCountersList, 'ESME');
						
						jolokia.request(
							[
								{ type: "read", mbean: "org.mobicents.smsc:layer=SmscMaintenanceCounters,name=SmscManagement"}
							],
							{ success: 
								function(response) {
									
									//clear clusters array, clear clusters select, remove allgraphs
									clusterSelect.unSelectAll();
									clusterSelect.removeAll();
									$('#graphs').html('');
									
									clustersCountersMap = response.value.AllCountersPerCluster;
									jQuery.each(clustersCountersMap, function(clusterName, value) {
										clusterSelect.add(clusterName, clusterName);
									});
								},
								error: function(value) {
									errorUID = ("st" + new Date().getTime()).hashCode();
									createStackTrace(errorUID, value.stacktrace);
									logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
								}
							}
						);
						
					}
					
					function addDataTable() {
						var dataTable = new google.visualization.DataTable();
						dataTable.addColumn('datetime', 'Time');
						return dataTable;
					}
					
			        function drawChart(chartTitle, dataTable, clusterName, type) {
						var divName = 'chart_div_'+type+'_' + clusterName;
						$('#graphs').append('<div id="' + divName + '" class="graph"/>');
						var chartOptions = {
								  title: chartTitle,
								  curveType: 'function',
								  pointSize: 5,
								  width: 1200,
								  height: 400,
								  hAxis: {title: 'Time',  titleTextStyle: {color: '#333'}},
								  vAxis: {minValue: 0},
						 };

						var chart = new google.visualization.LineChart(document.getElementById(divName));
						
						var clusterNameChartObj = charts["" + clusterName];
						var chartDataObj = clusterNameChartObj[""+type]; 
						chartDataObj.chartOptions = chartOptions;
						chartDataObj.chart = chart;

						chart.draw(dataTable, chartOptions);
					}
					
					function redrawCharts() {
						$.each(charts, function(clusterName, clusterNameChartObj) {
							$.each(clusterNameChartObj, function(type, chartDataObj) {
								chartDataObj.chart.draw(chartDataObj.dataTable, chartDataObj.chartOptions);
							});
						});
					}
					
					function getCountersByGroup(list, group) {
						jolokia.execute("org.mobicents.smsc:layer=SmscMaintenanceCounters,name=SmscManagement","getCountersByGroup", group,
							{ success: 
								function(response) {
									jQuery.each(response, function(index, value) {
										list.push(value);
									});
								},
								error: function(value) {
									errorUID = ("st" + new Date().getTime()).hashCode();
									createStackTrace(errorUID, value.stacktrace);
									logToConsole("ERROR", value.error + ". (<a href=\"#" + errorUID + "-modal\" data-toggle=\"modal\">Full Stack Trace</a>)");
								}
							}
						);
					}
					
					function getClusterName(esmeName) {
					}
					
					function refreshRate() {
						var timerIdValue = document.getElementById("timerIdValue").value;
						clearInterval(timerIdValue);

						var e = document.getElementById("refresh-rate-select");
						var refreshRate = e.options[e.selectedIndex].value;
						var timerId = setAutoCancellableInterval(refreshRate, "updateGraphs", "SMSC Maintenance Counters");

						$("#timerIdValue").val(timerId);
					}

					function createGraphs() {
						//Remove all rows
						
						var selectedClustersCopy = [];
						$.each(selectedClusters, function(index, value) {
							selectedClustersCopy.push(value);
						});
						
						$('#clusters-list-select option:selected').each(function(i) {
							//if it's NOT in selectedClusters, needs to be added, otherwise - skipped
							var clusterName = $(this).val();
							var pos = $.inArray(clusterName, selectedClustersCopy);
							if (pos == -1) {
								addClusterNameGraphs(clusterName);
							} else {
								selectedClustersCopy.splice(pos, 1);
							}
						});
						
						//if something was in selectedClusters but not among sleected options
						$.each(selectedClustersCopy, function(index, value) {
							removeClusterNameGraphs(value);
						});

						/*
						$.each(charts, function(clusterName, clusterNameChartObj) {
							$.each(clusterNameChartObj, function(type, chartDataObj) {
								var numRows = chartDataObj.dataTable.getNumberOfRows();
								if(numRows != 0) {
									chartDataObj.dataTable.removeRows(0, numRows);
								}
							});
						});
						*/

						updateGraphs();
						var timerIdValue = document.getElementById("timerIdValue").value;

						if(timerIdValue == "-1"){
							var timerId = setAutoCancellableInterval(60000, "updateGraphs", "SMSC Maintenance Counters");
							$("#timerIdValue").val(timerId);
						}
					}
					
					function addClusterNameGraphs(clusterName) {
						selectedClusters.push(clusterName);
																		
						var clusterDataTable = addDataTable();
						var esmesDataTable = addDataTable();

						var value = clustersCountersMap[clusterName];
						jQuery.each(value, function(counterGroup, val) {
							jQuery.each(val, function(index, counterName) {
								if (counterGroup == 'Cluster') {
									clusterDataTable.addColumn('number', counterName);
								} else if (counterGroup == 'ESME') {
									esmesDataTable.addColumn('number', counterName);
								}
								//console.log(counterName);
							});
						});
						
						charts["" + clusterName] = {};
						
						if (clusterDataTable.getNumberOfColumns() > 1) {
							charts["" + clusterName].cluster = {dataTable:clusterDataTable};
							drawChart('Cluster ' + clusterName + ' Maintenance Counters', clusterDataTable, clusterName, 'cluster');
							//console.log('clusterChart has ' + clusterChart.getNumberOfColumns() + ' number of columns');
							
						}
						if (esmesDataTable.getNumberOfColumns() > 1) {
							charts["" + clusterName].esme = {dataTable:esmesDataTable};
							drawChart('Esmes from Cluster ' + clusterName + ' Maintenance Counters', esmesDataTable, clusterName, 'esme');
							//console.log('esmesChart has ' + esmesChart.getNumberOfColumns() + ' number of columns');
						}
					}
					
					function removeClusterNameGraphs(clusterName) {
						selectedClusters.splice($.inArray(clusterName, selectedClusters), 1);
							
						var clusterDivName = 'chart_div_cluster_' + clusterName;
						var esmesDivName = 'chart_div_esme_' + clusterName;
						$('#'+clusterDivName).remove();
						$('#'+esmesDivName).remove();
					}

					function updateGraphs() {

						var e = document.getElementById("campaigns-list-select");
						var value = e.options[e.selectedIndex].text;

						if(value=="Select"){						
							return;
						}

						jolokia.request(
							[ 
								{ type: "exec", mbean: "org.mobicents.ss7:layer=COUNTER,name=CounterHost,type=Management", operation: "getLastCounterValues", arguments: [value]},
							],
							{ success: [ 
								function(response) {
									if(response.value == null){
										logToConsole("ERROR", "Last CounterValueSet Does not exist");
										return;
									}
									var counterValues = response.value.counterValues;
									
									console.log(counterValues);
									
									$.each(charts, function(clusterName, clusterNameChartObj) {
										var countersList = clustersCountersMap[clusterName];
										var clusterRowValuesArr = [];
										var esmeRowValuesArr = [];
										jQuery.each(countersList, function(counterGroup, val) {
											jQuery.each(val, function(index, counterName) {
												jQuery.each(counterValues, function() {
													if (this.counterDef.counterName == counterName) {
														if (counterGroup == 'Cluster') {
															clusterRowValuesArr.push(this.longValue);
														} else if (counterGroup == 'ESME') {
															esmeRowValuesArr.push(this.longValue);
														}
													}
												});
											});
										});
										var dateNow = new Date();

										
										if (clusterRowValuesArr.length != 0) {
											var row = [(dateNow)];
											$.merge(row, clusterRowValuesArr);
											clusterNameChartObj.cluster.dataTable.addRow(row);
										}
										if (esmeRowValuesArr.length != 0) {
											var row = [(dateNow)];
											$.merge(row, esmeRowValuesArr);
											clusterNameChartObj.esme.dataTable.addRow(row);
										}
									});
									
									redrawCharts();
								}
								],
								error: function(response) {
									alert("Jolokia request failed: " + response.error);
								} 
							}
						);
					}
					
					var clusterSelect;
					var campaignsSelect;
					
					$(document).ready(function () {
						refreshCampaignsList();
						$('#campaigns-list-select').SumoSelect();
						campaignsSelect = $('#campaigns-list-select')[0].sumo;
						$('#clusters-list-select').SumoSelect({
							placeholder: 'Select',
							search: true,
							searchText: 'Enter here',
							selectAll: true
						});
						clusterSelect = $('#clusters-list-select')[0].sumo;
					});
				
				</script>				